/* SCEditor v1.5.2 | (C) 2016, Sam Clarke | sceditor.com/license */
!function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d;d=function(a){"use strict";var b=c(1),d=c(2),e=c(3),f=c(7),g=c(6);b.sceditor=d,d.commands=c(9),d.defaultOptions=c(10),d.RangeHelper=c(4),d.dom=c(5),d.ie=f.ie,d.ios=f.ios,d.isWysiwygSupported=f.isWysiwygSupported,d.regexEscape=g.regex,d.escapeEntities=g.entities,d.escapeUriScheme=g.uriScheme,d.PluginManager=e,d.plugins=e.plugins,b.fn.sceditor=function(a){var c,e,g=[];if(a=a||{},a.runWithoutWysiwygSupport||f.isWysiwygSupported)return this.each(function(){c=this.jquery?this:b(this),e=c.data("sceditor"),c.parents(".sceditor-container").length>0||("state"===a?g.push(!!e):"instance"===a?g.push(e):e||new d(this,a))}),g.length?1===g.length?g[0]:b(g):this}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))},function(a,b){a.exports=jQuery},function(a,b,c){var d;d=function(a){"use strict";var b=c(1),d=c(3),e=c(4),f=c(5),g=c(6),h=c(7),i=c(8),j=window,k=document,l=b(j),m=b(k),n=h.ie,o=n&&n<11,p=/^image\/(p?jpe?g|gif|png|bmp)$/i,q=function(a,c){var r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa=this,ya=a.get?a.get(0):a,za=b(ya),Aa=[],Ba=[],Ca=[],Da={},Ea=[],Fa={};xa.commands=b.extend(!0,{},c.commands||q.commands),xa.opts=c=b.extend({},q.defaultOptions,c),N=function(){za.data("sceditor",xa),b.each(c,function(a,d){b.isPlainObject(d)&&(c[a]=b.extend(!0,{},d))}),c.locale&&"en"!==c.locale&&T(),r=b('<div class="sceditor-container" />').insertAfter(za).css("z-index",c.zIndex),n&&r.addClass("ie ie"+n),I=!!za.attr("required"),za.prop("required",!1),S(),Z(),U(),R(!!c.startInSourceMode),X(),V(),W(),h.isWysiwygSupported||xa.toggleSourceMode(),ka();var a=function(){l.off("load",a),c.autofocus&&pa(),c.autoExpand&&xa.expandToContent(),ia(),D.call("ready")};l.on("load",a),k.readyState&&"complete"===k.readyState&&a()},S=function(){var a=c.plugins;a=a?a.toString().split(","):[],D=new d(xa),b.each(a,function(a,c){D.register(b.trim(c))})},T=function(){var a;B=q.locale[c.locale],B||(a=c.locale.split("-"),B=q.locale[a[0]]),B&&B.dateFormat&&(c.dateFormat=B.dateFormat)},R=function(a){var d,f;x=b("<textarea></textarea>"),t=b('<iframe frameborder="0" allowfullscreen="true"></iframe>'),a?(r.addClass("sourceMode"),t.hide()):(r.addClass("wysiwygMode"),x.hide()),c.spellcheck||x.attr("spellcheck","false"),"https:"===j.location.protocol&&t.attr("src","javascript:false"),r.append(t).append(x),u=t[0],y=x[0],xa.dimensions(c.width||za.width(),c.height||za.height()),d=$(),d.open(),d.write(i("html",{attrs:n?' class="ie ie'+n+'"':"",spellcheck:c.spellcheck?"":'spellcheck="false"',charset:c.charset,style:c.style})),d.close(),w=b(d),v=b(d.body),xa.readOnly(!!c.readOnly),(h.ios||n)&&(v.height("100%"),n||v.on("touchend",xa.focus)),f=za.attr("tabindex"),x.attr("tabindex",f),t.attr("tabindex",f),C=new e(u.contentWindow),xa.val(za.hide().val())},V=function(){c.autoUpdate&&(v.on("blur",wa),x.on("blur",wa)),null===c.rtl&&(c.rtl="rtl"===x.css("direction")),xa.rtl(!!c.rtl),c.autoExpand&&w.on("keyup",xa.expandToContent),c.resizeEnabled&&Y(),r.attr("id",c.id),xa.emoticons(c.emoticonsEnabled)},W=function(){var a=n?"selectionchange":"keyup focus blur contextmenu mouseup touchend click",d="keydown keyup keypress focus blur contextmenu";m.click(ha),b(ya.form).on("reset",ea).submit(xa.updateOriginal),l.on("resize orientationChanged",ia),v.keypress(da).keydown(ba).keydown(ca).keyup(ma).blur(ua).keyup(va).on("paste",_).on(a,na).on(d,ga),c.emoticonsCompat&&j.getSelection&&v.keyup(ra),x.blur(ua).keyup(va).keydown(ba).on(d,ga),w.mousedown(fa).blur(ua).on(a,na).on("beforedeactivate keyup mouseup",Q).keyup(ma).focus(function(){A=null}),r.on("selectionchanged",oa).on("selectionchanged",ka).on("selectionchanged valuechanged nodechanged",ga)},U=function(){var a,d=xa.commands,e=(c.toolbarExclude||"").split(","),f=c.toolbar.split("|");s=b('<div class="sceditor-toolbar" unselectable="on" />'),b.each(f,function(c,f){a=b('<div class="sceditor-group" />'),b.each(f.split(","),function(c,f){var g,h,j=d[f];!j||b.inArray(f,e)>-1||(h=j.shortcut,g=i("toolbarButton",{name:f,dispName:xa._(j.name||j.tooltip||f)},!0),g.data("sceditor-txtmode",!!j.txtExec).data("sceditor-wysiwygmode",!!j.exec).toggleClass("disabled",!j.exec).click(function(){var a=b(this);return a.hasClass("disabled")||P(a,j),ka(),!1}),j.tooltip&&g.attr("title",xa._(j.tooltip)+(h?" ("+h+")":"")),h&&xa.addShortcut(h,f),j.state?Ca.push({name:f,state:j.state}):"string"==typeof j.exec&&Ca.push({name:f,state:j.exec}),a.append(g),Fa[f]=g)}),a[0].firstChild&&s.append(a)}),b(c.toolbarContainer||r).append(s)},X=function(){b.each(xa.commands,function(a,c){c.forceNewLineAfter&&b.isArray(c.forceNewLineAfter)&&(Ba=b.merge(Ba,c.forceNewLineAfter))}),ma()},Y=function(){var a,d,e,f,g,h,i=b('<div class="sceditor-grip" />'),k=b('<div class="sceditor-resize-cover" />'),l="touchmove mousemove",o="touchcancel touchend mouseup",p=0,q=0,s=0,t=0,u=0,v=0,w=r.width(),x=r.height(),y=!1,z=xa.rtl();a=c.resizeMinHeight||x/1.5,d=c.resizeMaxHeight||2.5*x,e=c.resizeMinWidth||w/1.25,f=c.resizeMaxWidth||1.25*w,g=function(b){"touchmove"===b.type?(b=j.event,s=b.changedTouches[0].pageX,t=b.changedTouches[0].pageY):(s=b.pageX,t=b.pageY);var g=v+(t-q),h=z?u-(s-p):u+(s-p);f>0&&h>f&&(h=f),e>0&&h<e&&(h=e),c.resizeWidth||(h=!1),d>0&&g>d&&(g=d),a>0&&g<a&&(g=a),c.resizeHeight||(g=!1),(h||g)&&(xa.dimensions(h,g),n<7&&r.height(g)),b.preventDefault()},h=function(a){y&&(y=!1,k.hide(),r.removeClass("resizing").height("auto"),m.off(l,g),m.off(o,h),a.preventDefault())},r.append(i),r.append(k.hide()),i.on("touchstart mousedown",function(a){"touchstart"===a.type?(a=j.event,p=a.touches[0].pageX,q=a.touches[0].pageY):(p=a.pageX,q=a.pageY),u=r.width(),v=r.height(),y=!0,r.addClass("resizing"),k.show(),m.on(l,g),m.on(o,h),n<7&&r.height(v),a.preventDefault()})},Z=function(){var a,d=c.emoticons,e=c.emoticonsRoot;b.isPlainObject(d)&&c.emoticonsEnabled&&b.each(d,function(c,f){b.each(f,function(b,f){e&&(f={url:e+(f.url||f),tooltip:f.tooltip||b},d[c][b]=f),a=k.createElement("img"),a.src=f.url||f,Aa.push(a)})})},pa=function(){var a,d,e=w[0],g=v[0],h=g.firstChild,i=!!c.autofocusEnd;if(r.is(":visible")){if(xa.sourceMode())return d=i?y.value.length:0,void(y.setSelectionRange?y.setSelectionRange(d,d):(a=y.createTextRange(),a.moveEnd("character",d),a.collapse(!1),a.select()));if(f.removeWhiteSpace(g),i)for((h=g.lastChild)||(h=e.createElement("p"),v.append(h));h.lastChild;)h=h.lastChild,!o&&b(h).is("br")&&h.previousSibling&&(h=h.previousSibling);e.createRange?(a=e.createRange(),f.canHaveChildren(h)?a.selectNodeContents(h):(a.setStartBefore(h),i&&a.setStartAfter(h))):(a=g.createTextRange(),a.moveToElementText(3!==h.nodeType?h:h.parentNode)),a.collapse(!i),C.selectRange(a),G=a,i&&(w.scrollTop(g.scrollHeight),v.scrollTop(g.scrollHeight)),xa.focus()}},xa.readOnly=function(a){return"boolean"!=typeof a?"readonly"===x.attr("readonly"):(v[0].contentEditable=!a,a?x.attr("readonly","readonly"):x.prop("readonly",!1),ja(a),xa)},xa.rtl=function(a){var b=a?"rtl":"ltr";return"boolean"!=typeof a?"rtl"===x.attr("dir"):(v.attr("dir",b),x.attr("dir",b),r.removeClass("rtl").removeClass("ltr").addClass(b),xa)},ja=function(a){var c=xa.inSourceMode()?"txtmode":"wysiwygmode";b.each(Fa,function(b,d){a!==!0&&d.data("sceditor-"+c)?d.removeClass("disabled"):d.addClass("disabled")})},xa.width=function(a,b){return a||0===a?(xa.dimensions(a,null,b),xa):r.width()},xa.dimensions=function(a,b,d){var e,f=n<8||k.documentMode<8?2:0;return a=!(!a&&0!==a)&&a,b=!(!b&&0!==b)&&b,a===!1&&b===!1?{width:xa.width(),height:xa.height()}:(t.data("outerWidthOffset")===e&&xa.updateStyleCache(),a!==!1&&(d!==!1&&(c.width=a),b===!1&&(b=r.height(),d=!1),r.width(a),a&&a.toString().indexOf("%")>-1&&(a=r.width()),t.width(a-t.data("outerWidthOffset")),x.width(a-x.data("outerWidthOffset")),h.ios&&v&&v.width(a-t.data("outerWidthOffset")-(v.outerWidth(!0)-v.width()))),b!==!1&&(d!==!1&&(c.height=b),b&&b.toString().indexOf("%")>-1&&(b=r.height(b).height(),r.height("auto")),b-=c.toolbarContainer?0:s.outerHeight(!0),t.height(b-t.data("outerHeightOffset")),x.height(b-f-x.data("outerHeightOffset"))),xa)},xa.updateStyleCache=function(){t.data("outerWidthOffset",t.outerWidth(!0)-t.width()),x.data("outerWidthOffset",x.outerWidth(!0)-x.width()),t.data("outerHeightOffset",t.outerHeight(!0)-t.height()),x.data("outerHeightOffset",x.outerHeight(!0)-x.height())},xa.height=function(a,b){return a||0===a?(xa.dimensions(null,a,b),xa):r.height()},xa.maximize=function(a){var d="sceditor-maximize";return"undefined"==typeof a?r.is("."+d):(a=!!a,a&&(L=l.scrollTop()),b("html, body").toggleClass(d,a),r.toggleClass(d,a),xa.width(a?"100%":c.width,!1),xa.height(a?"100%":c.height,!1),a||l.scrollTop(L),xa)},xa.expandToContent=function(a){var b=r.height(),d=b-t.height(),e=v[0].scrollHeight||w[0].documentElement.scrollHeight,f=c.resizeMaxHeight||2*(c.height||za.height());e+=d,(a===!0||e<=f)&&e>b&&xa.height(e)},xa.destroy=function(){D&&(D.destroy(),C=null,A=null,D=null,z&&z.off().remove(),m.off("click",ha),l.off("resize orientationChanged",ia),b(ya.form).off("reset",ea).off("submit",xa.updateOriginal),v.off(),w.off().find("*").remove(),x.off().remove(),s.remove(),r.off().find("*").off().remove(),r.remove(),za.removeData("sceditor").removeData("sceditorbbcode").show(),I&&za.attr("required","required"))},xa.createDropDown=function(a,d,e,f){var g,h="sceditor-"+d,i=z&&z.is("."+h);xa.closeDropDown(!0),i||(f!==!1&&b(e).find(":not(input,textarea)").filter(function(){return 1===this.nodeType}).attr("unselectable","on"),g={top:a.offset().top,left:a.offset().left,marginTop:a.outerHeight()},b.extend(g,c.dropDownCss),z=b('<div class="sceditor-dropdown '+h+'" />').css(g).append(e).appendTo(b("body")).on("click focusin",function(a){a.stopPropagation()}),setTimeout(function(){z&&z.find("input,textarea").first().focus()}))},ha=function(a){3!==a.which&&z&&(wa(),xa.closeDropDown())},_=function(a){var b=n||h.edge,c=v[0],d=a.originalEvent.clipboardData,e=function(a){var b=new FileReader;b.onload=function(a){aa({html:'<img src="'+a.target.result+'" />'})},b.readAsDataURL(a)};if(d&&!b){var f={},g=d.types,i=d.items;a.preventDefault();for(var j=0;j<g.length;j++){if(window.FileReader&&i&&p.test(i[j].type))return e(d.items[j].getAsFile());f[g[j]]=d.getData(g[j])}f.text=f["text/plain"],f.html=f["text/html"],aa(f)}else if(!M){var k=c.scrollTop;for(C.saveRange(),M=document.createDocumentFragment();c.firstChild;)M.appendChild(c.firstChild);setTimeout(function(){var a=c.innerHTML;c.innerHTML="",c.appendChild(M),c.scrollTop=k,M=!1,C.restoreRange(),aa({html:a})},0)}},aa=function(a){var c=w[0].createElement("div");D.call("pasteRaw",a),a.html?(c.innerHTML=a.html,f.fixNesting(c)):c.innerHTML=g.entities(a.text||"");var d={val:c.innerHTML};D.hasHandler("toSource")&&(v.append(c),d.val=D.callOnlyFirst("toSource",d.val,b(c)),b(c).remove()),D.call("paste",d),D.hasHandler("toWysiwyg")&&(d.val=D.callOnlyFirst("toWysiwyg",d.val,!0)),D.call("pasteHtml",d),xa.wysiwygEditorInsertHtml(d.val,null,!0)},xa.closeDropDown=function(a){z&&(z.off().remove(),z=null),a===!0&&xa.focus()},$=function(){return u.contentDocument?u.contentDocument:u.contentWindow&&u.contentWindow.document?u.contentWindow.document:u.document},xa.wysiwygEditorInsertHtml=function(a,c,d){var e,g,h,i=t.height();xa.focus(),(d||!b(F).is("code")&&0===b(F).parents("code").length)&&(C.insertHTML(a,c),C.saveRange(),O(v[0]),e=v.find("#sceditor-end-marker").show(),g=v.scrollTop()||w.scrollTop(),h=f.getOffset(e[0]).top+1.5*e.outerHeight(!0)-i,e.hide(),(h>g||h+i<g)&&(v.scrollTop(h),w.scrollTop(h)),ta(!1),C.restoreRange(),ma())},xa.wysiwygEditorInsertText=function(a,b){xa.wysiwygEditorInsertHtml(g.entities(a),g.entities(b))},xa.insertText=function(a,b){return xa.inSourceMode()?xa.sourceEditorInsertText(a,b):xa.wysiwygEditorInsertText(a,b),xa},xa.sourceEditorInsertText=function(a,b){var c,d,e,f=y.selectionStart,g=y.selectionEnd;d=y.scrollTop,y.focus(),"undefined"!=typeof f?(e=y.value,b&&(a+=e.substring(f,g)+b),y.value=e.substring(0,f)+a+e.substring(g,e.length),y.selectionStart=f+a.length-(b?b.length:0),y.selectionEnd=y.selectionStart):(c=k.selection.createRange(),b&&(a+=c.text+b),c.text=a,b&&c.moveEnd("character",0-b.length),c.moveStart("character",c.End-c.Start),c.select()),y.scrollTop=d,y.focus(),ta()},xa.getRangeHelper=function(){return C},xa.sourceEditorCaret=function(a){var b,c={};return y.focus(),"undefined"!=typeof y.selectionStart?a?(y.selectionStart=a.start,y.selectionEnd=a.end):(c.start=y.selectionStart,c.end=y.selectionEnd):(b=k.selection.createRange(),a?(b.moveEnd("character",a.end),b.moveStart("character",a.start),b.select()):(c.start=b.Start,c.end=b.End)),a?this:c},xa.val=function(a,b){return"string"!=typeof a?xa.inSourceMode()?xa.getSourceEditorValue(!1):xa.getWysiwygEditorValue(b):(xa.inSourceMode()?xa.setSourceEditorValue(a):(b!==!1&&D.hasHandler("toWysiwyg")&&(a=D.callOnlyFirst("toWysiwyg",a)),xa.setWysiwygEditorValue(a)),xa)},xa.insert=function(a,c,d,e,f){if(xa.inSourceMode())return xa.sourceEditorInsertText(a,c),xa;if(c){var g=C.selectedHtml(),h=b("<div>").appendTo(b("body")).hide().html(g);d!==!1&&D.hasHandler("toSource")&&(g=D.callOnlyFirst("toSource",g,h)),h.remove(),a+=g+c}return d!==!1&&D.hasHandler("toWysiwyg")&&(a=D.callOnlyFirst("toWysiwyg",a,!0)),d!==!1&&f===!0&&(a=a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),xa.wysiwygEditorInsertHtml(a),xa},xa.getWysiwygEditorValue=function(a){var c,d=b("<div>",w[0]).append(b(v[0].childNodes).clone()).appendTo(v);return f.fixNesting(d[0]),c=d.html(),a!==!1&&D.hasHandler("toSource")&&(c=D.callOnlyFirst("toSource",c,d)),d.remove(),c},xa.getBody=function(){return v},xa.getContentAreaContainer=function(){return t},xa.getSourceEditorValue=function(a){var b=x.val();return a!==!1&&D.hasHandler("toWysiwyg")&&(b=D.callOnlyFirst("toWysiwyg",b)),b},xa.setWysiwygEditorValue=function(a){a||(a="<p>"+(n?"":"<br />")+"</p>"),v[0].innerHTML=a,O(v[0]),ma(),ta()},xa.setSourceEditorValue=function(a){x.val(a),ta()},xa.updateOriginal=function(){za.val(xa.val())},O=function(a){if(c.emoticonsEnabled&&!b(a).parents("code").length){var d=a.ownerDocument,e="\\s| | | | |&nbsp;",h=[],j={},k=b.extend({},c.emoticons.more,c.emoticons.dropdown,c.emoticons.hidden);b.each(k,function(a){c.emoticonsCompat&&(j[a]=new RegExp("(>|^|"+e+")"+g.regex(a)+"($|<|"+e+")")),h.push(a)}),h.sort(function(a,b){return a.length-b.length});var l=function(a){for(a=a.firstChild;a;){var e,g,m,n,o,p,q,r=a.parentNode,s=a.nodeValue;if(3!==a.nodeType)b(a).is("code")||l(a);else if(s)for(o=h.length;o--;)g=h[o],q=c.emoticonsCompat?s.search(j[g]):s.indexOf(g),q>-1&&(p=a.nextSibling,m=k[g],e=s.substr(q).split(g),s=s.substr(0,q)+e.shift(),a.nodeValue=s,n=f.parseHTML(i("emoticon",{key:g,url:m.url||m,tooltip:m.tooltip||g}),d),r.insertBefore(n[0],p),r.insertBefore(d.createTextNode(e.join(g)),p));a=a.nextSibling}};l(a),c.emoticonsCompat&&(Ea=v.find("img[data-sceditor-emoticon]"))}},xa.inSourceMode=function(){return r.hasClass("sourceMode")},xa.sourceMode=function(a){var b=xa.inSourceMode();return"boolean"!=typeof a?b:((b&&!a||!b&&a)&&xa.toggleSourceMode(),xa)},xa.toggleSourceMode=function(){var a=xa.inSourceMode();!h.isWysiwygSupported&&a||(a||(C.saveRange(),C.clear()),xa.blur(),a?xa.setWysiwygEditorValue(xa.getSourceEditorValue()):xa.setSourceEditorValue(xa.getWysiwygEditorValue()),A=null,x.toggle(),t.toggle(),r.toggleClass("wysiwygMode",a).toggleClass("sourceMode",!a),ja(),ka())},la=function(){return y.focus(),"undefined"!=typeof y.selectionStart?y.value.substring(y.selectionStart,y.selectionEnd):k.selection.createRange().text},P=function(a,c){xa.inSourceMode()?c.txtExec&&(b.isArray(c.txtExec)?xa.sourceEditorInsertText.apply(xa,c.txtExec):c.txtExec.call(xa,a,la())):c.exec&&(b.isFunction(c.exec)?c.exec.call(xa,a):xa.execCommand(c.exec,c.hasOwnProperty("execParam")?c.execParam:null))},Q=function(){n&&(A=C.selectedRange())},xa.execCommand=function(a,c){var d=!1,e=xa.commands[a],f=b(C.parentNode());if(xa.focus(),!f.is("code")&&0===f.parents("code").length){try{d=w[0].execCommand(a,!1,c)}catch(a){}!d&&e&&e.errorMessage&&alert(xa._(e.errorMessage)),ka()}},na=function(){function a(){C&&!C.compare(G)&&(G=C.cloneSelected(),r.trigger(b.Event("selectionchanged"))),H=!1}H||(H=!0,n?a():setTimeout(a,100))},oa=function(){var a,c=C.parentNode();E!==c&&(a=E,E=c,F=C.getFirstBlockParent(c),r.trigger(b.Event("nodechanged",{oldNode:a,newNode:E})))},xa.currentNode=function(){return E},xa.currentBlockNode=function(){return F},ka=function(a){var b,c,d="active",e=w[0],f=xa.sourceMode();if(xa.readOnly())return void s.find(d).removeClass(d);f||(c=a?a.newNode:C.parentNode(),b=C.getFirstBlockParent(c));for(var g=0;g<Ca.length;g++){var h=0,i=Fa[Ca[g].name],j=Ca[g].state,k=f&&!i.data("sceditor-txtmode")||!f&&!i.data("sceditor-wysiwygmode");if("string"==typeof j){if(!f)try{h=e.queryCommandEnabled(j)?0:-1,h>-1&&(h=e.queryCommandState(j)?1:0)}catch(a){}}else k||(h=j.call(xa,c,b));i.toggleClass("disabled",k||h<0).toggleClass(d,h>0)}},da=function(a){var c,d,e,g,h="code,blockquote,pre",i="li,ul,ol";if(!a.originalEvent.defaultPrevented)return xa.closeDropDown(),c=b(F).closest(h+","+i).first(),13===a.which&&c.length&&!c.is(i)?(A=null,d=w[0].createElement("br"),C.insertNode(d),o||(e=d.parentNode,g=e.lastChild,g&&3===g.nodeType&&""===g.nodeValue&&(e.removeChild(g),g=e.lastChild),!f.isInline(e,!0)&&g===d&&f.isInline(d.previousSibling)&&C.insertHTML("<br>")),!1):void 0},ma=function(){var a,c,d,e=v[0];f.rTraverse(e,function(g){if(a=g.nodeName.toLowerCase(),b.inArray(a,Ba)>-1&&(c=!0),3===g.nodeType&&!/^\s*$/.test(g.nodeValue)||"br"===a||o&&!g.firstChild&&!f.isInline(g,!1))return c&&(d=w[0].createElement("p"),d.className="sceditor-nlf",d.innerHTML=o?"":"<br />",e.appendChild(d)),!1})},ea=function(){xa.val(za.val())},fa=function(){xa.closeDropDown(),A=null},ia=function(){var a=c.height,b=c.width;xa.maximize()?xa.dimensions("100%","100%",!1):(a&&a.toString().indexOf("%")>-1||b&&b.toString().indexOf("%")>-1)&&xa.dimensions(b,a)},xa._=function(){var a,b=arguments;return B&&B[b[0]]&&(b[0]=B[b[0]]),b[0].replace(/\{(\d+)\}/g,function(c,d){return b[d-0+1]!==a?b[d-0+1]:"{"+d+"}"})},ga=function(a){D.call(a.type+"Event",a,xa);var c=a.target===y?"scesrc":"scewys",d=b.Event(a);d.type=c+a.type,r.trigger(d,xa)},xa.bind=function(a,c,d,e){a=a.split(" ");for(var f=a.length;f--;)b.isFunction(c)&&(d||r.on("scewys"+a[f],c),e||r.on("scesrc"+a[f],c),"valuechanged"===a[f]&&(ta.hasHandler=!0));return xa},xa.unbind=function(a,c,d,e){a=a.split(" ");for(var f=a.length;f--;)b.isFunction(c)&&(d||r.off("scewys"+a[f],c),e||r.off("scesrc"+a[f],c));return xa},xa.blur=function(a,c,d){return b.isFunction(a)?xa.bind("blur",a,c,d):xa.sourceMode()?x.blur():v.blur(),xa},xa.focus=function(a,c,d){if(b.isFunction(a))xa.bind("focus",a,c,d);else if(xa.inSourceMode())y.focus();else{if(C.hasSelection())return;var e,f=C.selectedRange();G||C.hasSelection()||pa(),!o&&f&&1===f.endOffset&&f.collapsed&&(e=f.endContainer,e&&1===e.childNodes.length&&b(e.firstChild).is("br")&&(f.setStartBefore(e.firstChild),f.collapse(!0),C.selectRange(f))),u.contentWindow.focus(),v[0].focus(),A&&(C.selectRange(A),A=null)}return ka(),xa},xa.keyDown=function(a,b,c){return xa.bind("keydown",a,b,c)},xa.keyPress=function(a,b,c){return xa.bind("keypress",a,b,c)},xa.keyUp=function(a,b,c){return xa.bind("keyup",a,b,c)},xa.nodeChanged=function(a){return xa.bind("nodechanged",a,!1,!0)},xa.selectionChanged=function(a){return xa.bind("selectionchanged",a,!1,!0)},xa.valueChanged=function(a,b,c){return xa.bind("valuechanged",a,b,c)},qa=function(a){var d,e=0,f=xa.emoticonsCache,g=String.fromCharCode(a.which);if(!b(F).is("code")&&!b(F).parents("code").length)return f||(f=[],b.each(b.extend({},c.emoticons.more,c.emoticons.dropdown,c.emoticons.hidden),function(a,b){f[e++]=[a,i("emoticon",{key:a,url:b.url||b,tooltip:b.tooltip||a})]}),f.sort(function(a,b){return a[0].length-b[0].length}),xa.emoticonsCache=f,xa.longestEmoticonCode=f[f.length-1][0].length),d=C.replaceKeyword(xa.emoticonsCache,!0,!0,xa.longestEmoticonCode,c.emoticonsCompat,g),d&&c.emoticonsCompat?(Ea=v.find("img[data-sceditor-emoticon]"),/^\s$/.test(g)):!d},ra=function(){if(Ea.length){var a,c,d,e,f,g,h=xa.currentBlockNode(),i=!1,j=/[^\s\xA0\u2002\u2003\u2009\u00a0]+/;Ea=b.map(Ea,function(k){return k&&k.parentNode?b.contains(h,k)?(a=k.previousSibling,c=k.nextSibling,f=a.nodeValue,null===f&&(f=a.innerText||""),a&&j.test(a.nodeValue.slice(-1))||c&&j.test((c.nodeValue||"")[0])?(d=k.parentNode,e=C.cloneSelected(),g=e.startContainer,f+=b(k).data("sceditor-emoticon"),g===c?i=f.length+e.startOffset:g===h&&h.childNodes[e.startOffset]===c?i=f.length:g===a&&(i=e.startOffset),c&&3===c.nodeType||(c=d.insertBefore(d.ownerDocument.createTextNode(""),c)),c.insertData(0,f),d.removeChild(a),d.removeChild(k),i!==!1&&(e.setStart(c,i),e.collapse(!0),C.selectRange(e)),null):k):k:null})}},xa.emoticons=function(a){return a||a===!1?(c.emoticonsEnabled=a,a?(v.keypress(qa),xa.sourceMode()||(C.saveRange(),O(v[0]),Ea=v.find("img[data-sceditor-emoticon]"),ta(!1),C.restoreRange())):(v.find("img[data-sceditor-emoticon]").replaceWith(function(){return b(this).data("sceditor-emoticon")}),Ea=[],v.off("keypress",qa),ta()),xa):c.emoticonsEnabled},xa.css=function(a){return J||(J=b('<style id="#inline" />',w[0]).appendTo(w.find("head"))[0]),"string"!=typeof a?J.styleSheet?J.styleSheet.cssText:J.innerHTML:(J.styleSheet?J.styleSheet.cssText=a:J.innerHTML=a,xa)},ba=function(a){var b=[],c={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"},d={8:"backspace",9:"tab",13:"enter",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",91:"win",92:"win",93:"select",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},e={109:"-",110:"del",111:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"},f=a.which,g=d[f]||String.fromCharCode(f).toLowerCase();if((a.ctrlKey||a.metaKey)&&b.push("ctrl"),a.altKey&&b.push("alt"),a.shiftKey&&(b.push("shift"),e[f]?g=e[f]:c[g]&&(g=c[g])),g&&(f<16||f>18)&&b.push(g),b=b.join("+"),Da[b])return Da[b].call(xa)},xa.addShortcut=function(a,b){return a=a.toLowerCase(),"string"==typeof b?Da[a]=function(){return P(Fa[b],xa.commands[b]),!1}:Da[a]=b,xa},xa.removeShortcut=function(a){return delete Da[a.toLowerCase()],xa},ca=function(a){var d,e,f,g,h;if(!c.disableBlockRemove&&8===a.which&&(g=C.selectedRange())&&(j.getSelection?(d=g.startContainer,e=g.startOffset):(d=g.parentElement(),f=w[0].selection.createRange(),f.moveToElementText(d),f.setEndPoint("EndToStart",g),e=f.text.length),0===e&&(h=sa()))){for(;d!==h;){for(;d.previousSibling;)if(d=d.previousSibling,3!==d.nodeType||d.nodeValue)return;if(!(d=d.parentNode))return}if(h&&!b(h).is("body"))return xa.clearBlockFormatting(h),!1}},sa=function(){for(var a=F;!f.hasStyling(a)||f.isInline(a,!0);)if(!(a=a.parentNode)||b(a).is("body"))return;return a},xa.clearBlockFormatting=function(a){return a=a||sa(),!a||b(a).is("body")?xa:(C.saveRange(),a.className="",A=null,b(a).attr("style",""),b(a).is("p,div,td")||f.convertElement(a,"p"),C.restoreRange(),xa)},ta=function(a){if(D&&(D.hasHandler("valuechangedEvent")||ta.hasHandler)){var c,d=xa.sourceMode(),e=!d&&C.hasSelection();a=a!==!1&&!w[0].getElementById("sceditor-start-marker"),va.timer&&(clearTimeout(va.timer),va.timer=!1),e&&a&&C.saveRange(),c=d?x.val():v.html(),c!==ta.lastHtmlValue&&(ta.lastHtmlValue=c,r.trigger(b.Event("valuechanged",{rawValue:d?xa.val():c}))),e&&a&&C.removeMarkers()}},ua=function(){va.timer&&ta()},va=function(a){var b=a.which,c=va.lastChar,d=13===c||32===c,e=8===c||46===c;va.lastChar=b,13===b||32===b?d?va.triggerNextChar=!0:ta():8===b||46===b?e?va.triggerNextChar=!0:ta():va.triggerNextChar&&(ta(),va.triggerNextChar=!1),va.timer&&clearTimeout(va.timer),va.timer=setTimeout(function(){ta()},1500)},wa=function(){K||xa.updateOriginal(),K=!1},N()};return q.locale={},q.command={get:function(a){return q.commands[a]||null},set:function(a,c){return!(!a||!c)&&(c=b.extend(q.commands[a]||{},c),c.remove=function(){q.command.remove(a)},q.commands[a]=c,this)},remove:function(a){return q.commands[a]&&delete q.commands[a],this}},q}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))},function(a,b,c){var d;d=function(){"use strict";var a={},b=function(b){var c=this,d=[],e=function(a){return"signal"+a.charAt(0).toUpperCase()+a.slice(1)},f=function(a,c){a=[].slice.call(a);var f,g,h=e(a.shift());for(f=0;f<d.length;f++)if(h in d[f]&&(g=d[f][h].apply(b,a),c))return g};c.call=function(){f(arguments,!1)},c.callOnlyFirst=function(){return f(arguments,!0)},c.hasHandler=function(a){var b=d.length;for(a=e(a);b--;)if(a in d[b])return!0;return!1},c.exists=function(b){return b in a&&(b=a[b],"function"==typeof b&&"object"==typeof b.prototype)},c.isRegistered=function(b){if(c.exists(b))for(var e=d.length;e--;)if(d[e]instanceof a[b])return!0;return!1},c.register=function(e){return!(!c.exists(e)||c.isRegistered(e)||(e=new a[e],d.push(e),"init"in e&&e.init.call(b),0))},c.deregister=function(e){var f,g=d.length,h=!1;if(!c.isRegistered(e))return h;for(;g--;)d[g]instanceof a[e]&&(f=d.splice(g,1)[0],h=!0,"destroy"in f&&f.destroy.call(b));return h},c.destroy=function(){for(var a=d.length;a--;)"destroy"in d[a]&&d[a].destroy.call(b);d=[],b=null}};return b.plugins=a,b}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))},function(a,b,c){var d;d=function(a){"use strict";var b=c(1),d=c(5),e=c(6),f=c(7),g=f.ie,h=g&&g<11,i=function(a,b,c){var d,e,f,g,h,i="",j=a.startContainer,k=a.startOffset;for(j&&3!==j.nodeType&&(j=j.childNodes[k],k=0),f=g=k;c>i.length&&j&&3===j.nodeType;)d=j.nodeValue,e=c-i.length,h&&(g=d.length,f=0),h=j,b?(f=Math.max(g-e,0),k=f,i=d.substr(f,g-f)+i,j=h.previousSibling):(g=Math.min(e,d.length),k=f+g,i+=d.substr(f,g),j=h.nextSibling);return{node:h||j,offset:k,text:i}},j=function(a,c){var f,g,j=c||a.contentDocument||a.document,k="sceditor-start-marker",l="sceditor-end-marker",m=this;m.insertHTML=function(a,b){var c,d,e=m.selectedRange();if(!e)return!1;for(b&&(a+=m.selectedHtml()+b),d=j.createElement("p"),c=j.createDocumentFragment(),d.innerHTML=a;d.firstChild;)c.appendChild(d.firstChild);m.insertNode(c)},g=function(a,c,e){var g,h,i=j.createElement("div"),n=b(i);if("string"==typeof a?(c&&(a+=m.selectedHtml()+c),n.html(a)):(n.append(a),c&&n.append(m.selectedRange().extractContents()).append(c)),g=i.lastChild){for(;!d.isInline(g.lastChild,!0);)g=g.lastChild;return d.canHaveChildren(g)&&(h=b(g),g.lastChild||h.append("​")),m.removeMarkers(),(h||n).append(f(k)).append(f(l)),e?n.html():b(j.createDocumentFragment()).append(n.contents())[0]}},m.insertNode=function(a,b){var c=g(a,b),e=m.selectedRange(),f=e.commonAncestorContainer;return!!c&&(e.deleteContents(),f&&3!==f.nodeType&&!d.canHaveChildren(f)?f.parentNode.insertBefore(c,f):e.insertNode(c),void m.restoreRange())},m.cloneSelected=function(){var a=m.selectedRange();if(a)return a.cloneRange()},m.selectedRange=function(){var b,c,d=a.getSelection();if(d){if(d.getRangeAt&&d.rangeCount<=0){for(c=j.body;c.firstChild;)c=c.firstChild;b=j.createRange(),b.setStartBefore(c),d.addRange(b)}return d.rangeCount>0&&(b=d.getRangeAt(0)),b}},m.hasSelection=function(){var b=a.getSelection();return b&&b.rangeCount>0},m.selectedHtml=function(){var a,b=m.selectedRange();return b?(a=j.createElement("p"),a.appendChild(b.cloneContents()),a.innerHTML):""},m.parentNode=function(){var a=m.selectedRange();if(a)return a.parentElement?a.parentElement():a.commonAncestorContainer},m.getFirstBlockParent=function(a){var b=function(a){return d.isInline(a,!0)?(a=a?a.parentNode:null,a?b(a):a):a};return b(a||m.parentNode())},m.insertNodeAt=function(a,b){var c=m.selectedRange(),d=m.cloneSelected();return!!d&&(d.collapse(a),d.insertNode(b),void m.selectRange(c))},f=function(a){m.removeMarker(a);var b=j.createElement("span");return b.id=a,b.style.lineHeight="0",b.style.display="none",b.className="sceditor-selection sceditor-ignore",b.innerHTML=" ",b},m.insertMarkers=function(){var a=m.selectedRange();m.insertNodeAt(!0,f(k)),a&&a.collapsed?b(m.getMarker(k)).after(f(l)):m.insertNodeAt(!1,f(l))},m.getMarker=function(a){return j.getElementById(a)},m.removeMarker=function(a){var b=m.getMarker(a);b&&b.parentNode.removeChild(b)},m.removeMarkers=function(){m.removeMarker(k),m.removeMarker(l)},m.saveRange=function(){m.insertMarkers()},m.selectRange=function(c){var e,f=a.getSelection(),g=c.endContainer;if(!h&&c.collapsed&&g&&!d.isInline(g,!0)){for(e=g.lastChild;e&&b(e).is(".sceditor-ignore");)e=e.previousSibling;if(b(e).is("br")){var i=j.createRange();i.setEndAfter(e),i.collapse(!1),m.compare(c,i)&&(c.setStartBefore(e),c.collapse(!0))}}f&&(m.clear(),f.addRange(c))},m.restoreRange=function(){var a,b=m.selectedRange(),c=m.getMarker(k),d=m.getMarker(l);return!!(c&&d&&b)&&(a=c.nextSibling===d,b=j.createRange(),b.setStartBefore(c),b.setEndAfter(d),a&&b.collapse(!0),m.selectRange(b),void m.removeMarkers())},m.selectOuterText=function(a,b){var c,d,e=m.cloneSelected();return!!e&&(e.collapse(!1),c=i(e,!0,a),d=i(e,!1,b),e.setStart(c.node,c.offset),e.setEnd(d.node,d.offset),void m.selectRange(e))},m.getOuterText=function(a,b){var c=m.cloneSelected();return c?(c.collapse(!a),i(c,a,b).text):""},m.replaceKeyword=function(a,b,c,d,f,g){c||a.sort(function(a,b){return a[0].length-b[0].length});var h,i,j,k,l,n,o,p,q="(^|[\\s    ])",r=a.length,s=f?1:0,t=d||a[r-1][0].length;for(f&&t++,g=g||"",h=m.getOuterText(!0,t),l=h.length,h+=g,b&&(h+=m.getOuterText(!1,t));r--;)if(o=a[r][0],p=o.length,k=Math.max(0,l-p-s),j=-1,f?(i=h.substr(k).match(new RegExp(q+e.regex(o)+q)),i&&(j=i.index+k+i[1].length)):j=h.indexOf(o,k),j>-1&&j<=l&&j+p+s>=l)return n=l-j,m.selectOuterText(n,p-n-(/^\S/.test(g)?1:0)),m.insertHTML(a[r][1]),!0;return!1},m.compare=function(a,b){return b||(b=m.selectedRange()),a&&b?0===a.compareBoundaryPoints(Range.END_TO_END,b)&&0===a.compareBoundaryPoints(Range.START_TO_START,b):!a&&!b},m.clear=function(){var b=a.getSelection();b&&(b.removeAllRanges?b.removeAllRanges():b.empty&&b.empty())}};return j}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))},function(a,b,c){var d;d=function(a){"use strict";var b=c(1),d={},e={traverse:function(a,b,c,d,f){if(a)for(a=f?a.lastChild:a.firstChild;a;){var g=f?a.previousSibling:a.nextSibling;if(!c&&b(a)===!1||!d&&e.traverse(a,b,c,d,f)===!1||c&&b(a)===!1)return!1;a=g}},rTraverse:function(a,b,c,d){this.traverse(a,b,c,d,!0)},parseHTML:function(a,c){var d=[],e=(c||document).createElement("div");return e.innerHTML=a,b.merge(d,e.childNodes),d},hasStyling:function(a){var c=b(a);return a&&(!c.is("p,div")||a.className||c.attr("style")||!b.isEmptyObject(c.data()))},convertElement:function(a,b){for(var c,d,e=a.attributes,f=e.length,g=a.ownerDocument.createElement(b);f--;){d=e[f];try{g.setAttribute(d.name,d.value)}catch(a){}}for(;c=a.firstChild;)g.appendChild(c);return a.parentNode.replaceChild(g,a),g},blockLevelList:"|body|hr|p|div|h1|h2|h3|h4|h5|h6|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|blockquote|center|",canHaveChildren:function(a){return!!/11?|9/.test(a.nodeType)&&"|iframe|area|base|basefont|br|col|frame|hr|img|input|wbr|isindex|link|meta|param|command|embed|keygen|source|track|object|".indexOf("|"+a.nodeName.toLowerCase()+"|")<0},isInline:function(a,b){var c,d=(a||{}).nodeType||3;return 1!==d?3===d:(c=a.tagName.toLowerCase(),"code"===c?!b:e.blockLevelList.indexOf("|"+c+"|")<0)},copyCSS:function(a,b){b.style.cssText=a.style.cssText+b.style.cssText},fixNesting:function(a){
var b=function(a){for(;e.isInline(a.parentNode,!0);)a=a.parentNode;return a};e.traverse(a,function(a){if(1===a.nodeType&&!e.isInline(a,!0)&&e.isInline(a.parentNode,!0)){var c=b(a),d=c.parentNode,f=e.extractContents(c,a),g=a;e.copyCSS(c,g),d.insertBefore(f,c),d.insertBefore(g,c)}})},findCommonAncestor:function(a,c){return b(a).parents().has(b(c)).first()},getSibling:function(a,b){return a?(b?a.previousSibling:a.nextSibling)||e.getSibling(a.parentNode,b):null},removeWhiteSpace:function(a,c){for(var d,f,g,h,i,j,k,l,m=e.getSibling,n=e.isInline,o=a.firstChild;o;){if(k=o.nextSibling,d=o.nodeValue,f=o.nodeType,1===f&&o.firstChild&&(j=b(o).css("whiteSpace"),/pre(\-wrap)?$/i.test(j)||e.removeWhiteSpace(o,/line$/i.test(j))),3===f&&d){for(g=m(o),h=m(o,!0),l=!1;b(h).hasClass("sceditor-ignore");)h=m(h,!0);if(n(o)&&h){for(i=h;i.lastChild;)i=i.lastChild;l=3===i.nodeType?/[\t\n\r ]$/.test(i.nodeValue):!n(i)}d=d.replace(/\u200B/g,""),h&&n(h)&&!l||(d=d.replace(c?/^[\t ]+/:/^[\t\n\r ]+/,"")),g&&n(g)||(d=d.replace(c?/[\t ]+$/:/[\t\n\r ]+$/,"")),d.length?o.nodeValue=d.replace(c?/[\t ]+/g:/[\t\n\r ]+/g," "):a.removeChild(o)}o=k}},extractContents:function(a,c){var d,f=e.findCommonAncestor(a,c).get(0),g=!1,h=!1;return(d=function(f){var i,j=a.ownerDocument.createDocumentFragment();return e.traverse(f,function(e){return h||e===c?(h=!0,!1):(e===a&&(g=!0),void(b.contains(e,a)||g&&b.contains(e,c)?(i=e.cloneNode(!1),i.appendChild(d(e)),j.appendChild(i)):g&&!b.contains(j,e)&&j.appendChild(e)))},!1),j})(f)},getOffset:function(a){for(var b=0,c=0;a;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;return{left:b,top:c}},getStyle:function(a,c){var e,f,g,h=a.style;if(!h)return"";if(d[c]||(d[c]=b.camelCase(c)),c=d[c],g=h[c],"textAlign"===c){if(e=b(a),f=h.direction,g=g||e.css(c),e.parent().css(c)===g||"block"!==e.css("display")||e.is("hr")||e.is("th"))return"";if(/right/i.test(g)&&"rtl"===f||/left/i.test(g)&&"ltr"===f)return""}return g},hasStyle:function(a,c,d){var f=e.getStyle(a,c);return!!f&&(!d||f===d||b.isArray(d)&&b.inArray(f,d)>-1)}};return e}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))},function(a,b,c){var d;d=function(a,b){"use strict";var c=/^(https?|s?ftp|mailto|spotify|skype|ssh|teamspeak|tel):|(\/\/)|data:image\/(png|bmp|gif|p?jpe?g);/i;b.regex=function(a){return a.replace(/([\-.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},b.entities=function(a,b){if(!a)return a;var c={"&":"&amp;","<":"&lt;",">":"&gt;","  ":"&nbsp; ","\r\n":"<br />","\r":"<br />","\n":"<br />"};return b!==!1&&(c['"']="&#34;",c["'"]="&#39;",c["`"]="&#96;"),a=a.replace(/ {2}|\r\n|[&<>\r\n'"`]/g,function(a){return c[a]||a})},b.uriScheme=function(a){var b,d=/^[^\/]*:/i,e=window.location;return a&&d.test(a)&&!c.test(a)?(b=e.pathname.split("/"),b.pop(),e.protocol+"//"+e.host+b.join("/")+"/"+a):a}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))},function(a,b,c){var d;d=function(a,b){"use strict";var d=c(1),e=navigator.userAgent;b.ie=function(){var a,b=3,c=document,d=c.createElement("div"),e=d.getElementsByTagName("i");do d.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->";while(e[0]);return c.documentMode&&c.all&&window.atob&&(b=10),4===b&&c.documentMode&&(b=11),b>4?b:a}(),b.edge="-ms-ime-align"in document.documentElement.style,b.ios=/iPhone|iPod|iPad| wosbrowser\//i.test(e),b.isWysiwygSupported=function(){var a,c,f,g=d('<p contenteditable="true">')[0].contentEditable;return g!==f&&"inherit"!==g&&(c=/Opera Mobi|Opera Mini/i.test(e),/Android/i.test(e)&&(c=!0,/Safari/.test(e)&&(a=/Safari\/(\d+)/.exec(e),c=!a||!a[1]||a[1]<534)),/ Silk\//i.test(e)&&(a=/AppleWebKit\/(\d+)/.exec(e),c=!a||!a[1]||a[1]<534),b.ios&&(c=/OS [0-4](_\d)+ like Mac/i.test(e)),/Firefox/i.test(e)&&(c=!1),/OneBrowser/i.test(e)&&(c=!1),"UCWEB"===navigator.vendor&&(c=!1),b.ie<9&&(c=!0),!c)}()}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))},function(a,b,c){var d;d=function(a){"use strict";var b=c(1),d={html:'<!DOCTYPE html><html{attrs}><head><style>.ie * {min-height: auto !important} .ie table td {height:15px} @supports (-ms-ime-align:auto) { * { min-height: auto !important; } }</style><meta http-equiv="Content-Type" content="text/html;charset={charset}" /><link rel="stylesheet" type="text/css" href="{style}" /></head><body contenteditable="true" {spellcheck}><p></p></body></html>',toolbarButton:'<a class="sceditor-button sceditor-button-{name}" data-sceditor-command="{name}" unselectable="on"><div unselectable="on">{dispName}</div></a>',emoticon:'<img src="{url}" data-sceditor-emoticon="{key}" alt="{key}" title="{tooltip}" />',fontOpt:'<a class="sceditor-font-option" href="#" data-font="{font}"><font face="{font}">{font}</font></a>',sizeOpt:'<a class="sceditor-fontsize-option" data-size="{size}" href="#"><font size="{size}">{size}</font></a>',pastetext:'<div><label for="txt">{label}</label> <textarea cols="20" rows="7" id="txt"></textarea></div><div><input type="button" class="button" value="{insert}" /></div>',table:'<div><label for="rows">{rows}</label><input type="text" id="rows" value="2" /></div><div><label for="cols">{cols}</label><input type="text" id="cols" value="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',image:'<div><label for="link">{url}</label> <input type="text" id="image" placeholder="http://" /></div><div><label for="width">{width}</label> <input type="text" id="width" size="2" /></div><div><label for="height">{height}</label> <input type="text" id="height" size="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',email:'<div><label for="email">{label}</label> <input type="text" id="email" /></div><div><label for="des">{desc}</label> <input type="text" id="des" /></div><div><input type="button" class="button" value="{insert}" /></div>',link:'<div><label for="link">{url}</label> <input type="text" id="link" placeholder="http://" /></div><div><label for="des">{desc}</label> <input type="text" id="des" /></div><div><input type="button" class="button" value="{ins}" /></div>',youtubeMenu:'<div><label for="link">{label}</label> <input type="text" id="link" placeholder="https://" /></div><div><input type="button" class="button" value="{insert}" /></div>',youtube:'<iframe width="560" height="315" src="https://www.youtube.com/embed/{id}?wmode=opaque" data-youtube-id="{id}" frameborder="0" allowfullscreen></iframe>'};return function(a,c,e){var f=d[a];return b.each(c,function(a,b){f=f.replace(new RegExp("\\{"+a+"\\}","g"),b)}),e&&(f=b(f)),f}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))},function(a,b,c){var d;d=function(a){"use strict";function b(a){if("mozHidden"in document)for(var b,c=a.getBody()[0];c;){if(b=c,b.firstChild)b=b.firstChild;else{for(;b&&!b.nextSibling;)b=b.parentNode;b&&(b=b.nextSibling)}3===c.nodeType&&/[\n\r\t]+/.test(c.nodeValue)&&(/^pre/.test(d(c.parentNode).css("white-space"))||d(c).remove()),c=b}}var d=c(1),e=c(7).ie,f=c(8),g=e&&e<11,h={bold:{exec:"bold",tooltip:"Bold",shortcut:"Ctrl+B"},italic:{exec:"italic",tooltip:"Italic",shortcut:"Ctrl+I"},underline:{exec:"underline",tooltip:"Underline",shortcut:"Ctrl+U"},strike:{exec:"strikethrough",tooltip:"Strikethrough"},subscript:{exec:"subscript",tooltip:"Subscript"},superscript:{exec:"superscript",tooltip:"Superscript"},left:{exec:"justifyleft",tooltip:"Align left"},center:{exec:"justifycenter",tooltip:"Center"},right:{exec:"justifyright",tooltip:"Align right"},justify:{exec:"justifyfull",tooltip:"Justify"},font:{_dropDown:function(a,b,c){for(var e=0,g=a.opts.fonts.split(","),h=d("<div />"),i=function(){return c(d(this).data("font")),a.closeDropDown(!0),!1};e<g.length;e++)h.append(f("fontOpt",{font:g[e]},!0).click(i));a.createDropDown(b,"font-picker",h)},exec:function(a){var b=this;h.font._dropDown(b,a,function(a){b.execCommand("fontname",a)})},tooltip:"Font Name"},size:{_dropDown:function(a,b,c){for(var e=d("<div />"),g=function(b){c(d(this).data("size")),a.closeDropDown(!0),b.preventDefault()},h=1;h<=7;h++)e.append(f("sizeOpt",{size:h},!0).click(g));a.createDropDown(b,"fontsize-picker",e)},exec:function(a){var b=this;h.size._dropDown(b,a,function(a){b.execCommand("fontsize",a)})},tooltip:"Font Size"},color:{_dropDown:function(a,b,c){var e=d("<div />"),f="",g=h.color;g._htmlCache||(a.opts.colors.split("|").forEach(function(a){f+='<div class="sceditor-color-column">',a.split(",").forEach(function(a){f+='<a href="#" class="sceditor-color-option" style="background-color: '+a+'" data-color="'+a+'"></a>'}),f+="</div>"}),g._htmlCache=f),e.html(g._htmlCache).find("a").click(function(b){c(d(this).attr("data-color")),a.closeDropDown(!0),b.preventDefault()}),a.createDropDown(b,"color-picker",e)},exec:function(a){var b=this;h.color._dropDown(b,a,function(a){b.execCommand("forecolor",a)})},tooltip:"Font Color"},removeformat:{exec:"removeformat",tooltip:"Remove Formatting"},cut:{exec:"cut",tooltip:"Cut",errorMessage:"Your browser does not allow the cut command. Please use the keyboard shortcut Ctrl/Cmd-X"},copy:{exec:"copy",tooltip:"Copy",errorMessage:"Your browser does not allow the copy command. Please use the keyboard shortcut Ctrl/Cmd-C"},paste:{exec:"paste",tooltip:"Paste",errorMessage:"Your browser does not allow the paste command. Please use the keyboard shortcut Ctrl/Cmd-V"},pastetext:{exec:function(a){var b,c,d=this;c=f("pastetext",{label:d._("Paste your text inside the following box:"),insert:d._("Insert")},!0),c.find(".button").click(function(a){b=c.find("#txt").val(),b&&d.wysiwygEditorInsertText(b),d.closeDropDown(!0),a.preventDefault()}),d.createDropDown(a,"pastetext",c)},tooltip:"Paste Text"},bulletlist:{exec:function(){b(this),this.execCommand("insertunorderedlist")},tooltip:"Bullet list"},orderedlist:{exec:function(){b(this),this.execCommand("insertorderedlist")},tooltip:"Numbered list"},indent:{state:function(a,b){var c,e,f,g=d(b),h=g.parents("ul,ol,menu"),i=h.first();if(h.length>1||i.children().length>1)return 0;if(g.is("ul,ol,menu")){if(c=this.getRangeHelper().selectedRange(),!(window.Range&&c instanceof Range))return g.is("li,ul,ol,menu")?0:-1;if(e=c.startContainer.parentNode,f=c.endContainer.parentNode,e!==e.parentNode.firstElementChild||d(f).is("li")&&f!==f.parentNode.lastElementChild)return 0}return-1},exec:function(){var a=this,b=d(a.getRangeHelper().getFirstBlockParent());a.focus(),b.parents("ul,ol,menu")&&a.execCommand("indent")},tooltip:"Add indent"},outdent:{state:function(a,b){return d(b).is("ul,ol,menu")||d(b).parents("ul,ol,menu").length>0?0:-1},exec:function(){var a=this,b=d(a.getRangeHelper().getFirstBlockParent());b.parents("ul,ol,menu")&&a.execCommand("outdent")},tooltip:"Remove one indent"},table:{forceNewLineAfter:["table"],exec:function(a){var b=this,c=f("table",{rows:b._("Rows:"),cols:b._("Cols:"),insert:b._("Insert")},!0);c.find(".button").click(function(a){var d,e,f=c.find("#rows").val()-0,h=c.find("#cols").val()-0,i="<table>";if(!(f<1||h<1)){for(d=0;d<f;d++){for(i+="<tr>",e=0;e<h;e++)i+="<td>"+(g?"":"<br />")+"</td>";i+="</tr>"}i+="</table>",b.wysiwygEditorInsertHtml(i),b.closeDropDown(!0),a.preventDefault()}}),b.createDropDown(a,"inserttable",c)},tooltip:"Insert a table"},horizontalrule:{exec:"inserthorizontalrule",tooltip:"Insert a horizontal rule"},code:{forceNewLineAfter:["code"],exec:function(){this.wysiwygEditorInsertHtml("<code>",(g?"":"<br />")+"</code>")},tooltip:"Code"},image:{exec:function(a){var b=this,c=f("image",{url:b._("URL:"),width:b._("Width (optional):"),height:b._("Height (optional):"),insert:b._("Insert")},!0);c.find(".button").click(function(a){var d=c.find("#image").val(),e=c.find("#width").val(),f=c.find("#height").val(),g="";e&&(g+=' width="'+e+'"'),f&&(g+=' height="'+f+'"'),d&&b.wysiwygEditorInsertHtml("<img"+g+' src="'+d+'" />'),b.closeDropDown(!0),a.preventDefault()}),b.createDropDown(a,"insertimage",c)},tooltip:"Insert an image"},email:{exec:function(a){var b=this,c=f("email",{label:b._("E-mail:"),desc:b._("Description (optional):"),insert:b._("Insert")},!0);c.find(".button").click(function(a){var d=c.find("#email").val(),e=c.find("#des").val();d&&(b.focus(),!b.getRangeHelper().selectedHtml()||e?(e=e||d,b.wysiwygEditorInsertHtml('<a href="mailto:'+d+'">'+e+"</a>")):b.execCommand("createlink","mailto:"+d)),b.closeDropDown(!0),a.preventDefault()}),b.createDropDown(a,"insertemail",c)},tooltip:"Insert an email"},link:{exec:function(a){function b(a){c=h.val(),d=i.val(),c&&(e.focus(),!e.getRangeHelper().selectedHtml()||d?(d=d||c,e.wysiwygEditorInsertHtml('<a href="'+c+'">'+d+"</a>")):e.execCommand("createlink",c)),e.closeDropDown(!0),a.preventDefault()}var c,d,e=this,g=f("link",{url:e._("URL:"),desc:e._("Description (optional):"),ins:e._("Insert")},!0),h=g.find("#link"),i=g.find("#des");g.find(".button").click(b),h.add(i).keypress(function(a){13===a.which&&h.val()&&b(a)}),e.createDropDown(a,"insertlink",g)},tooltip:"Insert a link"},unlink:{state:function(){var a=d(this.currentNode());return a.is("a")||a.parents("a").length>0?0:-1},exec:function(){var a=d(this.currentNode()),b=a.is("a")?a:a.parents("a").first();b.length&&b.replaceWith(b.contents())},tooltip:"Unlink"},quote:{forceNewLineAfter:["blockquote"],exec:function(a,b,c){var d="<blockquote>",e="</blockquote>";b?(c=c?"<cite>"+c+"</cite>":"",d=d+c+b+e,e=null):""===this.getRangeHelper().selectedHtml()&&(e=(g?"":"<br />")+e),this.wysiwygEditorInsertHtml(d,e)},tooltip:"Insert a Quote"},emoticon:{exec:function(a){var b=this,c=function(e){var f,g=b.opts.emoticonsCompat,h=b.getRangeHelper(),i=g&&" "!==h.getOuterText(!0,1)?" ":"",j=g&&" "!==h.getOuterText(!1,1)?" ":"",k=d("<div />"),l=d("<div />").appendTo(k),m=0,n=d.extend({},b.opts.emoticons.dropdown,e?b.opts.emoticons.more:{});return d.each(n,function(){m++}),m=Math.sqrt(m),d.each(n,function(a,c){l.append(d("<img />").attr({src:c.url||c,alt:a,title:c.tooltip||a}).click(function(){return b.insert(i+d(this).attr("alt")+j,null,!1).closeDropDown(!0),!1})),l.children().length>=m&&(l=d("<div />").appendTo(k))}),!e&&b.opts.emoticons.more&&(f=d('<a class="sceditor-more">'+b._("More")+"</a>").click(function(){return b.createDropDown(a,"more-emoticons",c(!0)),!1}),k.append(f)),k};b.createDropDown(a,"emoticons",c(!1))},txtExec:function(a){h.emoticon.exec.call(this,a)},tooltip:"Insert an emoticon"},youtube:{_dropDown:function(a,b,c){var d,e=f("youtubeMenu",{label:a._("Video URL:"),insert:a._("Insert")},!0);e.find(".button").click(function(b){var f=e.find("#link").val();f&&(d=f.match(/(?:v=|v\/|embed\/|youtu.be\/)(.{11})/),d&&(f=d[1]),/^[a-zA-Z0-9_\-]{11}$/.test(f)?c(f):alert("Invalid YouTube video")),a.closeDropDown(!0),b.preventDefault()}),a.createDropDown(b,"insertlink",e)},exec:function(a){var b=this;h.youtube._dropDown(b,a,function(a){b.wysiwygEditorInsertHtml(f("youtube",{id:a}))})},tooltip:"Insert a YouTube video"},date:{_date:function(a){var b=new Date,c=b.getYear(),d=b.getMonth()+1,e=b.getDate();return c<2e3&&(c=1900+c),d<10&&(d="0"+d),e<10&&(e="0"+e),a.opts.dateFormat.replace(/year/i,c).replace(/month/i,d).replace(/day/i,e)},exec:function(){this.insertText(h.date._date(this))},txtExec:function(){this.insertText(h.date._date(this))},tooltip:"Insert current date"},time:{_time:function(){var a=new Date,b=a.getHours(),c=a.getMinutes(),d=a.getSeconds();return b<10&&(b="0"+b),c<10&&(c="0"+c),d<10&&(d="0"+d),b+":"+c+":"+d},exec:function(){this.insertText(h.time._time())},txtExec:function(){this.insertText(h.time._time())},tooltip:"Insert current time"},ltr:{state:function(a,b){return b&&"ltr"===b.style.direction},exec:function(){var a=this,b=a.getRangeHelper().getFirstBlockParent(),c=d(b);a.focus(),(b&&!c.is("body")||(a.execCommand("formatBlock","p"),b=a.getRangeHelper().getFirstBlockParent(),c=d(b),b&&!c.is("body")))&&("ltr"===c.css("direction")?c.css("direction",""):c.css("direction","ltr"))},tooltip:"Left-to-Right"},rtl:{state:function(a,b){return b&&"rtl"===b.style.direction},exec:function(){var a=this,b=a.getRangeHelper().getFirstBlockParent(),c=d(b);a.focus(),(b&&!c.is("body")||(a.execCommand("formatBlock","p"),b=a.getRangeHelper().getFirstBlockParent(),c=d(b),b&&!c.is("body")))&&("rtl"===c.css("direction")?c.css("direction",""):c.css("direction","rtl"))},tooltip:"Right-to-Left"},print:{exec:"print",tooltip:"Print"},maximize:{state:function(){return this.maximize()},exec:function(){this.maximize(!this.maximize())},txtExec:function(){this.maximize(!this.maximize())},tooltip:"Maximize",shortcut:"Ctrl+Shift+M"},source:{state:function(){return this.sourceMode()},exec:function(){this.toggleSourceMode()},txtExec:function(){this.toggleSourceMode()},tooltip:"View source",shortcut:"Ctrl+Shift+S"},ignore:{}};return h}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))},function(a,b,c){var d;d=function(a){"use strict";var b=c(1);return{toolbar:"bold,italic,underline,strike,subscript,superscript|left,center,right,justify|font,size,color,removeformat|cut,copy,paste,pastetext|bulletlist,orderedlist,indent,outdent|table|code,quote|horizontalrule,image,email,link,unlink|emoticon,youtube,date,time|ltr,rtl|print,maximize,source",toolbarExclude:null,style:"jquery.sceditor.default.css",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana",colors:"#000,#44B8FF,#1E92F7,#0074D9,#005DC2,#00369B,#b3d5f4|#444,#C3FFFF,#9DF9FF,#7FDBFF,#68C4E8,#419DC1,#d9f4ff|#666,#72FF84,#4CEA5E,#2ECC40,#17B529,#008E02,#c0f0c6|#888,#FFFF44,#FFFA1E,#FFDC00,#E8C500,#C19E00,#fff5b3|#aaa,#FFC95F,#FFA339,#FF851B,#E86E04,#C14700,#ffdbbb|#ccc,#FF857A,#FF5F54,#FF4136,#E82A1F,#C10300,#ffc6c3|#eee,#FF56FF,#FF30DC,#F012BE,#D900A7,#B20080,#fbb8ec|#fff,#F551FF,#CF2BE7,#B10DC9,#9A00B2,#9A00B2,#e8b6ef",locale:b("html").attr("lang")||"en",charset:"utf-8",emoticonsCompat:!1,emoticonsEnabled:!0,emoticonsRoot:"",emoticons:{dropdown:{":)":"emoticons/smile.png",":angel:":"emoticons/angel.png",":angry:":"emoticons/angry.png","8-)":"emoticons/cool.png",":'(":"emoticons/cwy.png",":ermm:":"emoticons/ermm.png",":D":"emoticons/grin.png","<3":"emoticons/heart.png",":(":"emoticons/sad.png",":O":"emoticons/shocked.png",":P":"emoticons/tongue.png",";)":"emoticons/wink.png"},more:{":alien:":"emoticons/alien.png",":blink:":"emoticons/blink.png",":blush:":"emoticons/blush.png",":cheerful:":"emoticons/cheerful.png",":devil:":"emoticons/devil.png",":dizzy:":"emoticons/dizzy.png",":getlost:":"emoticons/getlost.png",":happy:":"emoticons/happy.png",":kissing:":"emoticons/kissing.png",":ninja:":"emoticons/ninja.png",":pinch:":"emoticons/pinch.png",":pouty:":"emoticons/pouty.png",":sick:":"emoticons/sick.png",":sideways:":"emoticons/sideways.png",":silly:":"emoticons/silly.png",":sleeping:":"emoticons/sleeping.png",":unsure:":"emoticons/unsure.png",":woot:":"emoticons/w00t.png",":wassat:":"emoticons/wassat.png"},hidden:{":whistling:":"emoticons/whistling.png",":love:":"emoticons/wub.png"}},width:null,height:null,resizeEnabled:!0,resizeMinWidth:null,resizeMinHeight:null,resizeMaxHeight:null,resizeMaxWidth:null,resizeHeight:!0,resizeWidth:!0,dateFormat:"year-month-day",toolbarContainer:null,enablePasteFiltering:!1,disablePasting:!1,readOnly:!1,rtl:!1,autofocus:!1,autofocusEnd:!0,autoExpand:!1,autoUpdate:!1,spellcheck:!0,runWithoutWysiwygSupport:!1,startInSourceMode:!1,id:null,plugins:"",zIndex:null,bbcodeTrim:!1,disableBlockRemove:!1,parserOptions:{},dropDownCss:{}}}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}]),function(a,b,c){"use strict";var d=a.sceditor,e=d.plugins,f=d.escapeEntities,g=d.escapeUriScheme,h=d.ie,i=h&&h<11,j=d.command.get,k={bold:{txtExec:["[b]","[/b]"]},italic:{txtExec:["[i]","[/i]"]},underline:{txtExec:["[u]","[/u]"]},strike:{txtExec:["[s]","[/s]"]},subscript:{txtExec:["[sub]","[/sub]"]},superscript:{txtExec:["[sup]","[/sup]"]},left:{txtExec:["[left]","[/left]"]},center:{txtExec:["[center]","[/center]"]},right:{txtExec:["[right]","[/right]"]},justify:{txtExec:["[justify]","[/justify]"]},font:{txtExec:function(a){var b=this;j("font")._dropDown(b,a,function(a){b.insertText("[font="+a+"]","[/font]")})}},size:{txtExec:function(a){var b=this;j("size")._dropDown(b,a,function(a){b.insertText("[size="+a+"]","[/size]")})}},color:{txtExec:function(a){var b=this;j("color")._dropDown(b,a,function(a){b.insertText("[color="+a+"]","[/color]")})}},bulletlist:{txtExec:function(b,c){var d="";a.each(c.split(/\r?\n/),function(){d+=(d?"\n":"")+"[li]"+this+"[/li]"}),this.insertText("[ul]\n"+d+"\n[/ul]")}},orderedlist:{txtExec:function(b,c){var d="";a.each(c.split(/\r?\n/),function(){d+=(d?"\n":"")+"[li]"+this+"[/li]"}),e.bbcode.bbcode.get(""),this.insertText("[ol]\n"+d+"\n[/ol]")}},table:{txtExec:["[table][tr][td]","[/td][/tr][/table]"]},horizontalrule:{txtExec:["[hr]"]},code:{txtExec:["[code]","[/code]"]},image:{txtExec:function(a,b){var c=this,d=prompt(c._("Enter the image URL:"),b);d&&c.insertText("[img]"+d+"[/img]")}},email:{txtExec:function(a,b){var c,d=this,e=b&&b.indexOf("@")>-1?null:b,f=prompt(d._("Enter the e-mail address:"),e?"":b);f&&(c=prompt(d._("Enter the displayed text:"),e||f)||f,d.insertText("[email="+f+"]"+c+"[/email]"))}},link:{txtExec:function(b,c){var d=this,e=/^[a-z]+:\/\//i.test(a.trim(c))?null:c,f=prompt(d._("Enter URL:"),e?"http://":a.trim(c)),g=prompt(d._("Enter the displayed text:"),e||f)||f;f&&d.insertText("[url="+f+"]"+g+"[/url]")}},quote:{txtExec:["[quote]","[/quote]"]},youtube:{txtExec:function(a){var b=this;j("youtube")._dropDown(b,a,function(a){b.insertText("[youtube]"+a+"[/youtube]")})}},rtl:{txtExec:["[rtl]","[/rtl]"]},ltr:{txtExec:["[ltr]","[/ltr]"]}},l=function(a){return a?a.replace(/\\(.)/g,"$1").replace(/^(["'])(.*?)\1$/,"$2"):a},m=function(){var a,b=arguments;return b[0].replace(/\{(\d+)\}/g,function(c,d){return b[d-0+1]!==a?b[d-0+1]:"{"+d+"}"})},n={OPEN:"open",CONTENT:"content",NEWLINE:"newline",CLOSE:"close"},o=function(a,b,c,d,e,f){var g=this;g.type=a,g.name=b,g.val=c,g.attrs=d||{},g.children=e||[],g.closing=f||null};o.prototype={clone:function(a){var b=this;return new o(b.type,b.name,b.val,b.attrs,a?b.children:[],b.closing?b.closing.clone():null)},splitAt:function(b){var c,d=this,e=0,f=d.children.length;if("number"!=typeof b&&(b=a.inArray(b,d.children)),b<0||b>f)return null;for(;f--;)f>=b?e++:f=0;return c=d.clone(),c.children=d.children.splice(b,e),c}};var p=function(b){if(!(this instanceof p))return new p(b);var c,d,g,h,j,k,m,q,r,s,t,u,v,w,x,y=this;c=function(){y.bbcodes=e.bbcode.bbcodes,y.opts=a.extend({},p.defaults,b)},y.tokenize=function(a){var b,c,e,f=[],g=[{type:n.CLOSE,regex:/^\[\/[^\[\]]+\]/},{type:n.OPEN,regex:/^\[[^\[\]]+\]/},{type:n.NEWLINE,regex:/^(\r\n|\r|\n)/},{type:n.CONTENT,regex:/^([^\[\r\n]+|\[)/}];g.reverse();a:for(;a.length;){for(e=g.length;e--;)if(c=g[e].type,(b=a.match(g[e].regex))&&b[0]){f.push(d(c,b[0])),a=a.substr(b[0].length);continue a}a.length&&f.push(d(n.CONTENT,a)),a=""}return f},d=function(b,c){var d,f,h,i=/\[([^\]\s=]+)(?:([^\]]+))?\]/,j=/\[\/([^\[\]]+)\]/;return b===n.OPEN&&(d=c.match(i))&&(h=w(d[1]),d[2]&&(d[2]=a.trim(d[2]))&&(f=g(d[2]))),b===n.CLOSE&&(d=c.match(j))&&(h=w(d[1])),b===n.NEWLINE&&(h="#newline"),h&&(b!==n.OPEN&&b!==n.CLOSE||e.bbcode.bbcodes[h])||(b=n.CONTENT,h="#"),new o(b,h,c,f)},g=function(a){var b,c=/([^\s=]+)=(?:(?:(["'])((?:\\\2|[^\2])*?)\2)|((?:.(?!\s\S+=))*.))/g,d={};if("="===a.charAt(0)&&a.indexOf("=",1)<0)d.defaultattr=l(a.substr(1));else for("="===a.charAt(0)&&(a="defaultattr"+a);b=c.exec(a);)d[w(b[1])]=l(b[3])||b[4];return d},y.parse=function(a,b){var c=h(y.tokenize(a)),d=y.opts;return d.fixInvalidChildren&&r(c),d.removeEmptyTags&&q(c),d.fixInvalidNesting&&k(c),j(c,null,b),d.removeEmptyTags&&q(c),c},u=function(a,b,c){for(var d=c.length;d--;)if(c[d].type===b&&c[d].name===a)return!0;return!1},m=function(b,c){var d=b?y.bbcodes[b.name]:{},e=d.allowedChildren;return!y.opts.fixInvalidChildren||!e||a.inArray(c.name||"#",e)>-1},h=function(b){for(var c,d,e,f,g,h,i=[],j=[],k=[],l=function(){return x(k)},m=function(a){l()?l().children.push(a):j.push(a)},o=function(b){return l()&&(d=y.bbcodes[l().name])&&d.closedBy&&a.inArray(b,d.closedBy)>-1};c=b.shift();)switch(h=b[0],c.type){case n.OPEN:o(c.name)&&k.pop(),m(c),d=y.bbcodes[c.name],d&&d.isSelfClosing||!d.closedBy&&!u(c.name,n.CLOSE,b)?d&&d.isSelfClosing||(c.type=n.CONTENT):k.push(c);break;case n.CLOSE:if(l()&&c.name!==l().name&&o("/"+c.name)&&k.pop(),l()&&c.name===l().name)l().closing=c,k.pop();else if(u(c.name,n.OPEN,k)){for(;e=k.pop();){if(e.name===c.name){e.closing=c;break}f=e.clone(),i.length>1&&f.children.push(x(i)),i.push(f)}for(m(x(i)),g=i.length;g--;)k.push(i[g]);i.length=0}else c.type=n.CONTENT,m(c);break;case n.NEWLINE:l()&&h&&o((h.type===n.CLOSE?"/":"")+h.name)&&(h.type===n.CLOSE&&h.name===l().name||(d=y.bbcodes[l().name],d&&d.breakAfter?k.pop():d&&d.isInline===!1&&y.opts.breakAfterBlock&&d.breakAfter!==!1&&k.pop())),m(c);break;default:m(c)}return j},j=function(a,b,c){var d,e,f,g,h,i,k,l,m=a.length;b&&(g=y.bbcodes[b.name]);for(var o=m;o--;)if(d=a[o])if(d.type===n.NEWLINE){if(e=o>0?a[o-1]:null,f=o<m-1?a[o+1]:null,l=!1,!c&&g&&g.isSelfClosing!==!0&&(e?i||f||(g.isInline===!1&&y.opts.breakEndBlock&&g.breakEnd!==!1&&(l=!0),g.breakEnd&&(l=!0),i=l):(g.isInline===!1&&y.opts.breakStartBlock&&g.breakStart!==!1&&(l=!0),g.breakStart&&(l=!0))),e&&e.type===n.OPEN&&(h=y.bbcodes[e.name])&&(c?h.isInline===!1&&(l=!0):(h.isInline===!1&&y.opts.breakAfterBlock&&h.breakAfter!==!1&&(l=!0),h.breakAfter&&(l=!0))),!c&&!k&&f&&f.type===n.OPEN&&(h=y.bbcodes[f.name])&&(h.isInline===!1&&y.opts.breakBeforeBlock&&h.breakBefore!==!1&&(l=!0),h.breakBefore&&(l=!0),k=l,l)){a.splice(o,1);continue}l&&a.splice(o,1),k=!1}else d.type===n.OPEN&&j(d.children,d,c)},k=function(b,c,d,e){var f,g,h,i,j,l,m=function(a){var b=y.bbcodes[a.name];return!b||b.isInline!==!1};for(c=c||[],e=e||b,g=0;g<b.length;g++)if((f=b[g])&&f.type===n.OPEN){if(!m(f)&&d&&(h=x(c),l=h.splitAt(f),j=c.length>1?c[c.length-2].children:e,i=a.inArray(h,j),i>-1))return l.children.splice(a.inArray(f,l.children),1),void j.splice(i+1,0,f,l);c.push(f),k(f.children,c,d||m(f),e),c.pop(f)}},r=function(a,b){for(var c,d,e=a.length;e--;)(c=a[e])&&(m(b,c)||(c.name=null,c.type=n.CONTENT,m(b,c)?(d=[e+1,0].concat(c.children),c.closing&&(c.closing.name=null,c.closing.type=n.CONTENT,d.push(c.closing)),e+=d.length-1,Array.prototype.splice.apply(a,d)):b.children.splice(e,1)),c.type===n.OPEN&&r(c.children,c))},q=function(b){for(var c,d,e=function(a){for(var b=a.length;b--;){var c=a[b].type;if(c===n.OPEN||c===n.CLOSE)return!1;if(c===n.CONTENT&&/\S|\u00A0/.test(a[b].val))return!1}return!0},f=b.length;f--;)(c=b[f])&&c.type===n.OPEN&&(d=y.bbcodes[c.name],q(c.children),e(c.children)&&d&&!d.isSelfClosing&&!d.allowsEmpty&&b.splice.apply(b,a.merge([f,1],c.children)))},y.toHTML=function(a,b){return s(y.parse(a,b),!0)},s=function(b,c){var d,g,h,j,k,l,m,o,p,q=[];for(o=function(a){return(!a||(a.isHtmlInline!==d?a.isHtmlInline:a.isInline))!==!1};b.length>0;)if(g=b.shift()){if(g.type===n.OPEN)p=g.children[g.children.length-1]||{},h=y.bbcodes[g.name],l=c&&o(h),j=s(g.children,!1),h&&h.html?(o(h)||!o(y.bbcodes[p.name])||h.isPreFormatted||h.skipLastLineBreak||i||(j+="<br />"),a.isFunction(h.html)?k=h.html.call(y,g,g.attrs,j):(g.attrs[0]=j,k=e.bbcode.formatBBCodeString(h.html,g.attrs))):k=g.val+j+(g.closing?g.closing.val:"");else{if(g.type===n.NEWLINE){if(!c){q.push("<br />");continue}m||q.push("<div>"),i||q.push("<br />"),b.length||q.push("<br />"),q.push("</div>\n"),m=!1;continue}l=c,k=f(g.val,!0)}l&&!m?(q.push("<div>"),m=!0):!l&&m&&(q.push("</div>\n"),m=!1),q.push(k)}return m&&q.push("</div>\n"),q.join("")},y.toBBCode=function(a,b){return t(y.parse(a,b))},t=function(a){for(var b,c,d,e,f,g,h,i,j,k,l=[];a.length>0;)if(b=a.shift())if(d=y.bbcodes[b.name],e=!(!d||d.isInline!==!1),f=d&&d.isSelfClosing,h=e&&y.opts.breakBeforeBlock&&d.breakBefore!==!1||d&&d.breakBefore,i=e&&!f&&y.opts.breakStartBlock&&d.breakStart!==!1||d&&d.breakStart,j=e&&y.opts.breakEndBlock&&d.breakEnd!==!1||d&&d.breakEnd,k=e&&y.opts.breakAfterBlock&&d.breakAfter!==!1||d&&d.breakAfter,g=(d?d.quoteType:null)||y.opts.quoteType||p.QuoteType.auto,d||b.type!==n.OPEN)if(b.type===n.OPEN){if(h&&l.push("\n"),l.push("["+b.name),b.attrs){b.attrs.defaultattr&&(l.push("=",v(b.attrs.defaultattr,g,"defaultattr")),delete b.attrs.defaultattr);for(c in b.attrs)b.attrs.hasOwnProperty(c)&&l.push(" ",c,"=",v(b.attrs[c],g,c))}l.push("]"),i&&l.push("\n"),b.children&&l.push(t(b.children)),f||d.excludeClosing||(j&&l.push("\n"),l.push("[/"+b.name+"]")),k&&l.push("\n"),b.closing&&f&&l.push(b.closing.val)}else l.push(b.val);else l.push(b.val),b.children&&l.push(t(b.children)),b.closing&&l.push(b.closing.val);return l.join("")},v=function(b,c,d){var e=p.QuoteType,f=/\s|=/.test(b);return a.isFunction(c)?c(b,d):c===e.never||c===e.auto&&!f?b:'"'+b.replace("\\","\\\\").replace('"','\\"')+'"'},x=function(a){return a.length?a[a.length-1]:null},w=function(a){return a.toLowerCase()},c()};p.QuoteType={always:1,never:2,auto:3},p.defaults={breakBeforeBlock:!1,breakStartBlock:!1,breakEndBlock:!1,breakAfterBlock:!0,removeEmptyTags:!0,fixInvalidNesting:!0,fixInvalidChildren:!0,quoteType:p.QuoteType.auto},a.sceditorBBCodePlugin=e.bbcode=function(){var b,f,g,h,j=this;j.bbcodes=e.bbcode.bbcodes,j.stripQuotes=l;var n={},o={},q={ul:["li","ol","ul"],ol:["li","ol","ul"],table:["tr"],tr:["td","th"],code:["br","p","div"]};j.init=function(){j.opts=this.opts,b(),this.commands=a.extend(!0,{},k,this.commands),this.toBBCode=j.signalToSource,this.fromBBCode=j.signalToWysiwyg},b=function(){a.each(j.bbcodes,function(b){var c,d=j.bbcodes[b].tags,e=j.bbcodes[b].styles;d&&a.each(d,function(a,d){c=j.bbcodes[b].isInline===!1,n[a]=n[a]||{},n[a][c]=n[a][c]||{},n[a][c][b]=d}),e&&a.each(e,function(a,d){c=j.bbcodes[b].isInline===!1,o[c]=o[c]||{},o[c][a]=o[c][a]||{},o[c][a][b]=d})})},f=function(b,c,e){var f,g,h=d.dom.getStyle;return e=!!e,o[e]?(a.each(o[e],function(d,e){f=h(b[0],d),f&&h(b.parent()[0],d)!==f&&a.each(e,function(d,e){(!e||a.inArray(f.toString(),e)>-1)&&(g=j.bbcodes[d].format,c=a.isFunction(g)?g.call(j,b,c):m(g,c))})}),c):c},g=function(b,c,e){var f,g,h=b[0],k=h.nodeName.toLowerCase();e=!!e,n[k]&&n[k][e]&&a.each(n[k][e],function(d,e){e&&(f=!1,a.each(e,function(c,d){if(b.attr(c)&&!(d&&a.inArray(b.attr(c),d)<0))return f=!0,!1}),!f)||(g=j.bbcodes[d].format,c=a.isFunction(g)?g.call(j,b,c):m(g,c))});var l=d.dom.isInline;if(e&&(!l(h,!0)||"br"===k)){for(var o,p,q,r=h.previousSibling;r&&1===r.nodeType&&!a(r).is("br")&&l(r,!0)&&!r.firstChild;)r=r.previousSibling;do p=h.parentNode,q=p.lastChild,o=q===h,h=p;while(p&&o&&l(p,!0));(!o||"li"===k||"br"===k&&i)&&(c+="\n"),"br"!==k&&r&&!a(r).is("br")&&l(r,!0)&&(c="\n"+c)}return c},j.signalToSource=function(b,e){var f,g,h=new p(j.opts.parserOptions);return e||("string"==typeof b?(f=a("<div />").css("visibility","hidden").appendTo(c.body).html(b),e=f):e=a(b)),e&&e.jquery?(d.dom.removeWhiteSpace(e[0]),a(".sceditor-ignore",e).remove(),g=j.elementToBbcode(e),f&&f.remove(),g=h.toBBCode(g,!0),j.opts.bbcodeTrim&&(g=a.trim(g)),g):""},j.elementToBbcode=function(b){var c=function(b,e){var h="";return d.dom.traverse(b,function(b){var d=a(b),j="",k=b.nodeType,l=b.nodeName.toLowerCase(),m=q[l],n=b.firstChild,o=!0;if("object"==typeof e&&(o=a.inArray(l,e)>-1,d.is("img")&&d.data("sceditor-emoticon")&&(o=!0),o||(m=e)),3===k||1===k)if(1===k){if(d.hasClass("sceditor-nlf")&&(!n||!i&&1===b.childNodes.length&&/br/i.test(n.nodeName)))return;"iframe"!==l&&(j=c(b,m)),o?("code"!==l&&(j=f(d,j),j=g(d,j),j=f(d,j,!0)),h+=g(d,j,!0)):h+=j}else h+=b.nodeValue},!1,!0),h};return c(b[0])},j.signalToWysiwyg=function(b,c){var d=new p(j.opts.parserOptions),e=d.toHTML(j.opts.bbcodeTrim?a.trim(b):b);return c?h(e):e},h=function(b){var e,f,g,h=a("<div />").hide().appendTo(c.body),j=h[0];return g=function(b,e){if(!d.dom.hasStyling(b)){if(i||1!==b.childNodes.length||!a(b.firstChild).is("br"))for(;f=b.firstChild;)j.insertBefore(f,b);if(e){var g=j.lastChild;b!==g&&a(g).is("div")&&b.nextSibling===g&&j.insertBefore(c.createElement("br"),b)}j.removeChild(b)}},j.innerHTML=b.replace(/<\/div>\n/g,"</div>"),(e=j.firstChild)&&a(e).is("div")&&g(e,!0),(e=j.lastChild)&&a(e).is("div")&&g(e),j=j.innerHTML,h.remove(),j}},e.bbcode.formatBBCodeString=function(a,b){return a.replace(/\{([^}]+)\}/g,function(a,c){var d,e=!0;return"!"===c.charAt(0)&&(e=!1,
c=c.substring(1)),"0"===c&&(e=!1),b[c]===d?a:e?f(b[c],!0):b[c]})};var q=function(a){return a=parseInt(a,10),isNaN(a)?"00":(a=Math.max(0,Math.min(a,255)).toString(16),a.length<2?"0"+a:a)},r=function(a){var b;return a=a||"#000",(b=a.match(/rgb\((\d{1,3}),\s*?(\d{1,3}),\s*?(\d{1,3})\)/i))?"#"+q(b[1])+q(b[2]-0)+q(b[3]-0):(b=a.match(/#([0-f])([0-f])([0-f])\s*?$/i))?"#"+b[1]+b[1]+b[2]+b[2]+b[3]+b[3]:a},s={b:{tags:{b:null,strong:null},styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:"[b]{0}[/b]",html:"<strong>{0}</strong>"},i:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},u:{tags:{u:null},styles:{"text-decoration":["underline"]},format:"[u]{0}[/u]",html:"<u>{0}</u>"},s:{tags:{s:null,strike:null},styles:{"text-decoration":["line-through"]},format:"[s]{0}[/s]",html:"<s>{0}</s>"},sub:{tags:{sub:null},format:"[sub]{0}[/sub]",html:"<sub>{0}</sub>"},sup:{tags:{sup:null},format:"[sup]{0}[/sup]",html:"<sup>{0}</sup>"},font:{tags:{font:{face:null}},styles:{"font-family":null},quoteType:p.QuoteType.never,format:function(a,b){var c;return a.is("font")&&(c=a.attr("face"))||(c=a.css("font-family")),"[font="+l(c)+"]"+b+"[/font]"},html:'<font face="{defaultattr}">{0}</font>'},size:{tags:{font:{size:null}},styles:{"font-size":null},format:function(a,b){var c=a.attr("size"),d=2;return c||(c=a.css("fontSize")),c.indexOf("px")>-1?(c=c.replace("px","")-0,c<12&&(d=1),c>15&&(d=3),c>17&&(d=4),c>23&&(d=5),c>31&&(d=6),c>47&&(d=7)):d=c,"[size="+d+"]"+b+"[/size]"},html:'<font size="{defaultattr}">{!0}</font>'},color:{tags:{font:{color:null}},styles:{color:null},quoteType:p.QuoteType.never,format:function(a,b){var c;return a.is("font")&&(c=a.attr("color"))||(c=a[0].style.color||a.css("color")),"[color="+r(c)+"]"+b+"[/color]"},html:function(a,b,c){return'<font color="'+f(r(b.defaultattr),!0)+'">'+c+"</font>"}},ul:{tags:{ul:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ul]{0}[/ul]",html:"<ul>{0}</ul>"},list:{breakStart:!0,isInline:!1,skipLastLineBreak:!0,html:"<ul>{0}</ul>"},ol:{tags:{ol:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ol]{0}[/ol]",html:"<ol>{0}</ol>"},li:{tags:{li:null},isInline:!1,closedBy:["/ul","/ol","/list","*","li"],format:"[li]{0}[/li]",html:"<li>{0}</li>"},"*":{isInline:!1,closedBy:["/ul","/ol","/list","*","li"],html:"<li>{0}</li>"},table:{tags:{table:null},isInline:!1,isHtmlInline:!0,skipLastLineBreak:!0,format:"[table]{0}[/table]",html:"<table>{0}</table>"},tr:{tags:{tr:null},isInline:!1,skipLastLineBreak:!0,format:"[tr]{0}[/tr]",html:"<tr>{0}</tr>"},th:{tags:{th:null},allowsEmpty:!0,isInline:!1,format:"[th]{0}[/th]",html:"<th>{0}</th>"},td:{tags:{td:null},allowsEmpty:!0,isInline:!1,format:"[td]{0}[/td]",html:"<td>{0}</td>"},emoticon:{allowsEmpty:!0,tags:{img:{src:null,"data-sceditor-emoticon":null}},format:function(a,b){return a.data("sceditor-emoticon")+b},html:"{0}"},hr:{tags:{hr:null},allowsEmpty:!0,isSelfClosing:!0,isInline:!1,format:"[hr]{0}",html:"<hr />"},img:{allowsEmpty:!0,tags:{img:{src:null}},allowedChildren:["#"],quoteType:p.QuoteType.never,format:function(a,b){var c,d,e="",f=a[0],g=function(a){return f.style?f.style[a]:null};return a.attr("data-sceditor-emoticon")?b:(c=a.attr("width")||g("width"),d=a.attr("height")||g("height"),(f.complete&&(c||d)||c&&d)&&(e="="+a.width()+"x"+a.height()),"[img"+e+"]"+a.attr("src")+"[/img]")},html:function(a,b,c){var d,e,h,i,j="";return e=b.width,h=b.height,b.defaultattr&&(i=b.defaultattr.split(/x/i),e=i[0],h=2===i.length?i[1]:i[0]),e!==d&&(j+=' width="'+f(e,!0)+'"'),h!==d&&(j+=' height="'+f(h,!0)+'"'),"<img"+j+' src="'+g(c)+'" />'}},url:{allowsEmpty:!0,tags:{a:{href:null}},quoteType:p.QuoteType.never,format:function(a,b){var c=a.attr("href");return"mailto:"===c.substr(0,7)?'[email="'+c.substr(7)+'"]'+b+"[/email]":"[url="+c+"]"+b+"[/url]"},html:function(a,b,c){return b.defaultattr=f(b.defaultattr,!0)||c,'<a href="'+g(b.defaultattr)+'">'+c+"</a>"}},email:{quoteType:p.QuoteType.never,html:function(a,b,c){return'<a href="mailto:'+(f(b.defaultattr,!0)||c)+'">'+c+"</a>"}},quote:{tags:{blockquote:null},isInline:!1,quoteType:p.QuoteType.never,format:function(b,c){var d="",e=a(b),f=e.children("cite").first();return(1===f.length||e.data("author"))&&(d=f.text()||e.data("author"),e.data("author",d),f.remove(),c=this.elementToBbcode(a(b)),d="="+d.replace(/(^\s+|\s+$)/g,""),e.prepend(f)),"[quote"+d+"]"+c+"[/quote]"},html:function(a,b,c){return b.defaultattr&&(c="<cite>"+f(b.defaultattr)+"</cite>"+c),"<blockquote>"+c+"</blockquote>"}},code:{tags:{code:null},isInline:!1,allowedChildren:["#","#newline"],format:"[code]{0}[/code]",html:"<code>{0}</code>"},left:{styles:{"text-align":["left","-webkit-left","-moz-left","-khtml-left"]},isInline:!1,format:"[left]{0}[/left]",html:'<div align="left">{0}</div>'},center:{styles:{"text-align":["center","-webkit-center","-moz-center","-khtml-center"]},isInline:!1,format:"[center]{0}[/center]",html:'<div align="center">{0}</div>'},right:{styles:{"text-align":["right","-webkit-right","-moz-right","-khtml-right"]},isInline:!1,format:"[right]{0}[/right]",html:'<div align="right">{0}</div>'},justify:{styles:{"text-align":["justify","-webkit-justify","-moz-justify","-khtml-justify"]},isInline:!1,format:"[justify]{0}[/justify]",html:'<div align="justify">{0}</div>'},youtube:{allowsEmpty:!0,tags:{iframe:{"data-youtube-id":null}},format:function(a,b){return a=a.attr("data-youtube-id"),a?"[youtube]"+a+"[/youtube]":b},html:'<iframe width="560" height="315" frameborder="0" src="https://www.youtube.com/embed/{0}?wmode=opaque" data-youtube-id="{0}" allowfullscreen></iframe>'},rtl:{styles:{direction:["rtl"]},format:"[rtl]{0}[/rtl]",html:'<div style="direction: rtl">{0}</div>'},ltr:{styles:{direction:["ltr"]},format:"[ltr]{0}[/ltr]",html:'<div style="direction: ltr">{0}</div>'},ignore:{}};e.bbcode.bbcode={get:function(a){return s[a]||null},set:function(b,c){return!(!b||!c)&&(c=a.extend(s[b]||{},c),c.remove=function(){delete s[b]},s[b]=c,this)},rename:function(a,b){return a in s&&(s[b]=s[a],delete s[a],this)},remove:function(a){return a in s&&delete s[a],this}},a.fn.sceditorBBCodePlugin=function(b){return b=b||{},a.isPlainObject(b)&&(b.plugins=(b.plugins||"")+"bbcode"),this.sceditor(b)},e.bbcode.normaliseColour=r,e.bbcode.formatString=m,e.bbcode.stripQuotes=l,e.bbcode.bbcodes=s,d.BBCodeParser=p}(jQuery,window,document);